
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ingress/">
      
      
        <link rel="next" href="../security/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>Observability - Istio 0 to 60 Labs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#observability" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Istio 0 to 60 Labs" class="md-header__button md-logo" aria-label="Istio 0 to 60 Labs" data-md-component="logo">
      <img id="logo_light_mode" src="../assets/tetrate-logo-white.png" alt="logo">
<img id="logo_dark_mode" src="../assets/tetrate-logo-black.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Istio 0 to 60 Labs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Observability
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tetratelabs/istio-0to60" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Istio 0 to 60 Labs" class="md-nav__button md-logo" aria-label="Istio 0 to 60 Labs" data-md-component="logo">
      <img id="logo_light_mode" src="../assets/tetrate-logo-white.png" alt="logo">
<img id="logo_dark_mode" src="../assets/tetrate-logo-black.png" alt="logo">

    </a>
    Istio 0 to 60 Labs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tetratelabs/istio-0to60" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lab environment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Istio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../sidecar-injection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sidecar injection
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service discovery and load balancing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../the-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The application
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../ingress/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Observability
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Observability
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-the-addons" class="md-nav__link">
    Deploy the Addons
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-a-load" class="md-nav__link">
    Generate a load
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiali" class="md-nav__link">
    Kiali
  </a>
  
    <nav class="md-nav" aria-label="Kiali">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kiali-cleanup" class="md-nav__link">
    Kiali Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zipkin" class="md-nav__link">
    Zipkin
  </a>
  
    <nav class="md-nav" aria-label="Zipkin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zipkin-cleanup" class="md-nav__link">
    Zipkin Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prometheus" class="md-nav__link">
    Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observe-how-envoy-exposes-a-prometheus-scrape-endpoint" class="md-nav__link">
    Observe how Envoy exposes a Prometheus scrape endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-the-dashboard" class="md-nav__link">
    Access the dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grafana" class="md-nav__link">
    Grafana
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    Cleanup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next" class="md-nav__link">
    Next
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-shifting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traffic shifting
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../circuit-breakers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Circuit breakers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-the-addons" class="md-nav__link">
    Deploy the Addons
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generate-a-load" class="md-nav__link">
    Generate a load
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kiali" class="md-nav__link">
    Kiali
  </a>
  
    <nav class="md-nav" aria-label="Kiali">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kiali-cleanup" class="md-nav__link">
    Kiali Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zipkin" class="md-nav__link">
    Zipkin
  </a>
  
    <nav class="md-nav" aria-label="Zipkin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zipkin-cleanup" class="md-nav__link">
    Zipkin Cleanup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prometheus" class="md-nav__link">
    Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observe-how-envoy-exposes-a-prometheus-scrape-endpoint" class="md-nav__link">
    Observe how Envoy exposes a Prometheus scrape endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-the-dashboard" class="md-nav__link">
    Access the dashboard
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grafana" class="md-nav__link">
    Grafana
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    Cleanup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next" class="md-nav__link">
    Next
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="observability">Observability<a class="headerlink" href="#observability" title="Permanent link">&para;</a></h1>
<p>This lab explores one of the main strengths of Istio: observability.</p>
<p>The services in our mesh are automatically made observable, without adding any burden on devops teams.</p>
<h2 id="deploy-the-addons">Deploy the Addons<a class="headerlink" href="#deploy-the-addons" title="Permanent link">&para;</a></h2>
<p>The Istio distribution provides addons for a number of systems that together provide observability for the service mesh:</p>
<ul>
<li><a href="https://zipkin.io/" target="_blank">Zipkin</a> or <a href="https://www.jaegertracing.io/" target="_blank">Jaeger</a> for distributed tracing</li>
<li><a href="https://prometheus.io/" target="_blank">Prometheus</a> for metrics collection</li>
<li><a href="https://grafana.com/" target="_blank">Grafana</a> provides dashboards for monitoring, using Prometheus as the data source</li>
<li><a href="https://kiali.io/" target="_blank">Kiali</a> allows us to visualize the mesh</li>
</ul>
<p>These addons are located in the <code>samples/addons/</code> folder of the distribution.</p>
<ol>
<li>
<p>Navigate to the addons directory</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>~/istio-1.19.3/samples/addons
</code></pre></div>
</li>
<li>
<p>Deploy each addon:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>prometheus.yaml
</code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>grafana.yaml
</code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>extras/zipkin.yaml
</code></pre></div>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>kiali.yaml
</code></pre></div>
</li>
<li>
<p>Verify that the <code>istio-system</code> namespace is now running additional workloads for each of the addons.</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-n<span class="w"> </span>istio-system
</code></pre></div>
</li>
</ol>
<p>The <code>istioctl</code> CLI provides convenience commands for accessing the web UIs for each dashboard.</p>
<p>Take a moment to review the help information for the <code>istioctl dashboard</code> command:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>istioctl<span class="w"> </span>dashboard<span class="w"> </span>--help
</code></pre></div>
<h2 id="generate-a-load">Generate a load<a class="headerlink" href="#generate-a-load" title="Permanent link">&para;</a></h2>
<p>In order to have something to observe, we need to generate a load on our system.</p>
<p>Use a simple bash <code>while</code> loop to make repeated <code>curl</code> requests to the app:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>curl<span class="w"> </span>-I<span class="w"> </span>http://<span class="nv">$GATEWAY_IP</span><span class="p">;</span><span class="w"> </span>sleep<span class="w"> </span><span class="m">0</span>.5<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<p>The curl requests will be running in foreground.
It may be simplest to obtain a new shell prompt by opening a second, separate terminal.</p>
<h2 id="kiali">Kiali<a class="headerlink" href="#kiali" title="Permanent link">&para;</a></h2>
<p>Launch the Kiali dashboard:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>istioctl<span class="w"> </span>dashboard<span class="w"> </span>kiali
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the dashboard page fails to open, just click on the hyperlink in the console output.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>istioctl dashboard</code> command also blocks.
Leave it running until you're finished using the dashboard, at which time 
press <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span> to interrupt the process and get back to the terminal prompt.</p>
</div>
<p>The Kiali dashboard displays.</p>
<p>Customize the view as follows:</p>
<ol>
<li>Select the <em>Graph</em> section from the sidebar.</li>
<li>Under <em>Select Namespaces</em> (at the top of the page), select the <code>default</code> namespace, the location where the application's pods are running.</li>
<li>From the third "pulldown" menu, select <em>App graph</em>.</li>
<li>From the <em>Display</em> "pulldown", toggle on <em>Traffic Animation</em> and <em>Security</em>.</li>
<li>From the footer, toggle the legend so that it is visible.  Take a moment to familiarize yourself with the legend.</li>
</ol>
<p>Observe the visualization and note the following:</p>
<ul>
<li>We can see traffic coming in through the ingress gateway to the <code>web-frontend</code>, and the subsequent calls from the <code>web-frontend</code> to the <code>customers</code> service.</li>
<li>The lines connecting the services are green, indicating healthy requests.</li>
<li>The small lock icon on each edge in the graph indicates that the traffic is secured with mutual TLS.</li>
</ul>
<p>Such visualizations are helpful with understanding the flow of requests in the mesh, and with diagnosis.</p>
<p>Feel free to spend more time exploring Kiali.</p>
<p>We will revisit Kiali in a later lab to visualize traffic shifting such as when performing a blue-green or canary deployment.</p>
<h3 id="kiali-cleanup">Kiali Cleanup<a class="headerlink" href="#kiali-cleanup" title="Permanent link">&para;</a></h3>
<p>Close the Kiali dashboard.  Interrupt the <code>istioctl dashboard kiali</code> command by pressing <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span>.</p>
<h2 id="zipkin">Zipkin<a class="headerlink" href="#zipkin" title="Permanent link">&para;</a></h2>
<p>Launch the Zipkin dashboard:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>istioctl<span class="w"> </span>dashboard<span class="w"> </span>zipkin
</code></pre></div>
<p>The Zipkin dashboard displays.</p>
<ul>
<li>Click on the red '+' button and select <em>serviceName</em>.</li>
<li>Select the service named <code>web-frontend.default</code> and click on the <em>Run Query</em> button (lightblue) on the right.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Trace Sampling</p>
<p>When you installed Istio at the start of this workshop, the default configuration uses the <a href="https://github.com/istio/istio/blob/master/manifests/profiles/default.yaml#L121" target="_blank">default profile, which sets trace sampling to 1% of requests</a>.</p>
<p>If you wish to increase the trace sampling percentage to capture more distributed traces, you can upgrade the Istio installation with the following command:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>istioctl<span class="w"> </span>install<span class="w"> </span>--set<span class="w"> </span>values.pilot.traceSampling<span class="o">=</span><span class="m">100</span>
</code></pre></div>
</div>
<p>A number of query results will display.  Each row is expandable and will display more detail in terms of the services participating in that particular trace.</p>
<ul>
<li>Click the <em>Show</em> button to the right of one of the traces having four (4) spans.</li>
</ul>
<p>The resulting view shows spans that are part of the trace, and more importantly how much time was spent within each span.  Such information can help diagnose slow requests and pin-point where the latency lies.</p>
<p>Distributed tracing also helps us make sense of the flow of requests in a microservice architecture.</p>
<h3 id="zipkin-cleanup">Zipkin Cleanup<a class="headerlink" href="#zipkin-cleanup" title="Permanent link">&para;</a></h3>
<p>Close the Zipkin dashboard.  Interrupt the <code>istioctl dashboard zipkin</code> command with <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span>.</p>
<h2 id="prometheus">Prometheus<a class="headerlink" href="#prometheus" title="Permanent link">&para;</a></h2>
<p>Prometheus works by periodically calling a metrics endpoint against each running service (this endpoint is termed the "scrape" endpoint).  Developers normally have to instrument their applications to expose such an endpoint and return metrics information in the format the Prometheus expects.</p>
<p>With Istio, this is done automatically by the Envoy sidecar.</p>
<h3 id="observe-how-envoy-exposes-a-prometheus-scrape-endpoint">Observe how Envoy exposes a Prometheus scrape endpoint<a class="headerlink" href="#observe-how-envoy-exposes-a-prometheus-scrape-endpoint" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Run the following command:</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>svc/customers<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>localhost:15020/stats/prometheus<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>istio_requests
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Why port 15020?</p>
<p>See <a href="https://istio.io/latest/docs/ops/deployment/requirements/#ports-used-by-istio" target="_blank">Ports used by Istio</a> sidecar proxy.</p>
</div>
<p>The list of metrics returned by the endpoint is rather lengthy, so we just peek at "istio_requests" metric.  The full response contains many more metrics.</p>
</li>
</ol>
<h3 id="access-the-dashboard">Access the dashboard<a class="headerlink" href="#access-the-dashboard" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Start the prometheus dashboard</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>istioctl<span class="w"> </span>dashboard<span class="w"> </span>prometheus
</code></pre></div>
</li>
<li>
<p>In the search field enter the metric named <code>istio_requests_total</code>, and click the <em>Execute</em> button (on the right).</p>
</li>
<li>
<p>Select the tab named <em>Graph</em> to obtain a graphical representation of this metric over time.</p>
<p>Note that you are looking at requests across the entire mesh, i.e. this includes both requests to <code>web-frontend</code> and to <code>customers</code>.</p>
</li>
<li>
<p>As an example of Prometheus' dimensional metrics capability, we can ask for total requests having a response code of 200:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>istio_requests_total{response_code=&quot;200&quot;}
</code></pre></div>
</li>
<li>
<p>With respect to requests, it's more interesting to look at the rate of incoming requests over a time window.  Try:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>rate(istio_requests_total[5m])
</code></pre></div>
</li>
</ol>
<p>There's much more to the Prometheus query language (<a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank">this</a> may be a good place to start).</p>
<p>Grafana consumes these metrics to produce graphs on our behalf.</p>
<ul>
<li>Close the Prometheus dashboard and terminate the corresponding <code>istioctl dashboard</code> command.</li>
</ul>
<h2 id="grafana">Grafana<a class="headerlink" href="#grafana" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Launch the Grafana dashboard</p>
<div class="language-shell highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>istioctl<span class="w"> </span>dashboard<span class="w"> </span>grafana
</code></pre></div>
</li>
<li>
<p>From the sidebar, select <em>Dashboards</em> &rarr; <em>Browse</em></p>
</li>
<li>Click on the folder named <em>Istio</em> to reveal pre-designed Istio-specific Grafana dashboards</li>
<li>Explore the Istio Mesh Dashboard.  Note the Global Request Volume and Global Success Rate.</li>
<li>Explore the Istio Service Dashboard.  First select the service <code>web-frontend</code> and inspect its metrics, then switch to the <code>customers</code> service and review its dashboard.</li>
<li>Explore the Istio Workload Dashboard.  Select the <code>web-frontend</code> workload.  Look at Outbound Services and note the outbound requests to the customers service.  Select the <code>customers</code> workload and note that it makes no Oubtound Services calls.</li>
</ol>
<p>Feel free to further explore these dashboards.</p>
<h2 id="cleanup">Cleanup<a class="headerlink" href="#cleanup" title="Permanent link">&para;</a></h2>
<ol>
<li>Terminate the <code>istioctl dashboard</code> command (<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span>)</li>
<li>Likewise, terminate the bash while loop.</li>
</ol>
<h2 id="next">Next<a class="headerlink" href="#next" title="Permanent link">&para;</a></h2>
<p>We turn our attention next to security features of a service mesh.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ingress/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Ingress">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Ingress
              </div>
            </div>
          </a>
        
        
          
          <a href="../security/" class="md-footer__link md-footer__link--next" aria-label="Next: Security">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Security
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.instant", "navigation.tracking", "navigation.footer"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>